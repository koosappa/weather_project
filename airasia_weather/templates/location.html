
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.css" />

    <script>

    //   const demo = document.getElementById('demo');
      function error(err) {
        //   demo.innerHTML = `Failed to locate. Error: ${err.message}`;
        alert("Hiii");
      }

      function success(pos) {
        //   demo.innerHTML = 'Located.';
        //   alert(`${pos.coords.latitude}, ${pos.coords.longitude}`);
          const lat = pos.coords.latitude;
          const long = pos.coords.longitude;
          alert(lat);
          $.ajax({
                    type:"POST",
                    url: "location",
                    header:{"Access-Control-Allow-Origin":"*",
                          "Access-Control-Allow-Headers":"*"},
                    // headers: {'X-CSRFToken': csrftoken},
                    data: {
                    "lat":lat,
                    "long" :long,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'

                    },
                    async:false,
                    success: function(data){
                    myData = data
                    // var myData = "{{myData|escapejs}}";
                     console.log("Im final data" + JSON.parse(myData));
                    //  final_data = JSON.parse(myData);
                    //  console.log(final_data);
            },
            fail:function(err){
                alert("failed");
            }

  });


      }

      function getGeolocation() {
          if (navigator.geolocation) {
            //   demo.innerHTML = 'Locating…';
              navigator.geolocation.getCurrentPosition(success, error);
          } else { 
              alert("heloo");
            //   demo.innerHTML = 'Geolocation is not supported by this browser.';
          }
      }
   
     </script>

</head>
<body>
    <section class="hero is-primary">
        <div class="container">
            <div class="get-quote">
                <div class="row">
                    <div class="col-sm-6 col-12">
                        <a href="/"><h3 id="quote">AirAsia  Weather</h3></a>
                    </div>
                    <div class="col-sm-4 col-12">

                        <a type="button" class="btn btn-success" href='add_city'>Add City</button>
                        <a type="button" class="btn btn-success" href='location'>Location</a>
<!--                         <a type="button" class="btn btn-success" heref='table_content'>Table/Carosal</a> -->
                        <a type="button" class="btn btn-success" heref='view_data'>5 days View</a>
                        
                        
                    </div>
                    
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-offset-4 is-4">

     
            <form action="/location" method="post">
                {% csrf_token %}
                
                <button type="button" class="btn btn-primary btn-lg btn-block" onclick="getGeolocation()">Find location </button>
                {% if message %}
                            <div class="notification {{ message_class }}">{{ message }}<button class="del-msg delete" onclick="document.getElementsByClassName('notification')[0].style.display='none'"></button></div>
                            
                        {% endif %}

    </form>

               
</div>
</div>
</div>
</section>


<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column is-offset-4 is-4">
                {% for city_weather in weather_data %}
                <div class="box">
                    <article class="media">
                        <div class="media-left">
                            <figure class="image is-50x50">
                                <img src="http://openweathermap.org/img/w/{{ city_weather.icon }}.png" alt="Image">
                            </figure>
                        </div>
                        <div class="media-content">
                            <div class="content">
                                <p>
                                    <span class="title">{{ city_weather.city_name }}</span>
                                    <br>
                                    <span class="subtitle">{{ city_weather.temp }}° F</span>
                                    <br> {{ city_weather.description }}
                                </p>
                            </div>
                        </div>

                    </article>
                </div>
               {% endfor %}
            </div>
        </div>
    </div>
</section>

</body>
